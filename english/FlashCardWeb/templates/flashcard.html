<!DOCTYPE html>
<html>
<head>
    <title>FlashCard Study</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        .flashcard-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0;
        }

        .flashcard {
            width: 300px;
            height: 200px;
            perspective: 1000px;
            cursor: pointer;
        }

        .flashcard .front,
        .flashcard .back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            transition: transform 0.6s;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .flashcard .back {
            transform: rotateY(180deg);
        }

        .flashcard.flipped .front {
            transform: rotateY(180deg);
        }

        .flashcard.flipped .back {
            transform: rotateY(0deg);
        }

        .nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            border: none;
            background: none;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s;
            padding: 0;
        }

        .nav-btn:hover {
            opacity: 1;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
        }

        .prev-btn {
            left: 40px;
        }

        .next-btn {
            right: 40px;
        }

        .prev-btn::before {
            border-width: 15px 20px 15px 0;
            border-color: transparent #4285f4 transparent transparent;
            position: absolute;
            content: '';
            top: 50%;
            left: 50%;
            transform: translate(-25%, -50%);
        }

        .next-btn::before {
            border-width: 15px 0 15px 20px;
            border-color: transparent transparent transparent #4285f4;
            position: absolute;
            content: '';
            top: 50%;
            left: 50%;
            transform: translate(-75%, -50%);
        }

        .hidden {
            display: none;
        }

        .celebration-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: center;
            font-size: 1.5rem;
            color: #4285f4;
            z-index: 1000;
            display: none;
        }

        .celebration-message.show {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        .flashcard-container.hide {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-out, visibility 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="flashcard-container">
        <button class="nav-btn prev-btn {% if current_index == 0 %}hidden{% endif %}" 
                onclick="navigate('prev')" 
                aria-label="Ïù¥Ï†Ñ Ïπ¥Îìú">
        </button>
        
        <div class="flashcard" onclick="flipCard()">
            <div class="front">
                <p>{{ front_text }}</p>
            </div>
            <div class="back">
                <p>{{ back_text }}</p>
            </div>
        </div>
        
        <button class="nav-btn next-btn {% if current_index >= all_data|length - 1 %}hidden{% endif %}" 
                onclick="navigate('next')" 
                aria-label="Îã§Ïùå Ïπ¥Îìú">
        </button>
    </div>

    <div class="celebration-message" id="celebrationMessage">
        Ïò§Îäò Í≥µÎ∂ÄÎ•º Î™®Îëê ÎßàÏ≥§ÏäµÎãàÎã§! Ï∂ïÌïòÎìúÎ¶ΩÎãàÎã§! üéâ
    </div>

    <script>
        let isFlipped = false;
        let autoFlipTimer;
        let autoNextTimer;
        let currentIndex = {{ current_index }};
        const totalCards = {{ all_data|length }};
        const selectedLanguage = "{{ selected_language }}";
        const allData = {{ all_data|tojson|safe }};

        function updateCardContent(index) {
            const card = allData[index];
            const frontElement = document.querySelector('.front p');
            const backElement = document.querySelector('.back p');
            
            if (frontElement && backElement) {
                if (selectedLanguage === 'korean') {
                    frontElement.textContent = card.korean;
                    backElement.textContent = card.english;
                } else {
                    frontElement.textContent = card.english;
                    backElement.textContent = card.korean;
                }
            }
        }

        function startConfetti() {
            const duration = 3000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            function randomInRange(min, max) {
                return Math.random() * (max - min) + min;
            }

            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();

                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }

                const particleCount = 50 * (timeLeft / duration);
                
                // ÏôºÏ™ΩÍ≥º Ïò§Î•∏Ï™ΩÏóêÏÑú Ìè≠Ï£Ω Î∞úÏÇ¨
                confetti({
                    ...defaults,
                    particleCount,
                    origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 }
                });
                confetti({
                    ...defaults,
                    particleCount,
                    origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 }
                });
            }, 250);
        }

        function showCelebration() {
            const message = document.getElementById('celebrationMessage');
            const container = document.querySelector('.flashcard-container');
            
            // ÌîåÎûòÏãúÏπ¥Îìú Ïª®ÌÖåÏù¥ÎÑà Ïà®Í∏∞Í∏∞
            container.classList.add('hide');
            
            // Ï∂ïÌïò Î©îÏãúÏßÄ ÌëúÏãú Î∞è Ìè≠Ï£Ω ÏãúÏûë
            message.classList.add('show');
            startConfetti();
        }

        function startTimers() {
            clearTimers();
            autoFlipTimer = setTimeout(() => {
                flipCard();
                if (currentIndex < totalCards - 1) {
                    autoNextTimer = setTimeout(() => {
                        navigate('next');
                    }, 5000);
                } else if (isFlipped) {
                    // ÎßàÏßÄÎßâ Ïπ¥ÎìúÍ∞Ä Îí§ÏßëÌûå ÌõÑ 5Ï¥à Îí§Ïóê Ï∂ïÌïò Î©îÏãúÏßÄ ÌëúÏãú
                    setTimeout(() => {
                        showCelebration();
                    }, 5000);
                }
            }, 5000);
        }

        function clearTimers() {
            clearTimeout(autoFlipTimer);
            clearTimeout(autoNextTimer);
        }

        function flipCard() {
            const card = document.querySelector('.flashcard');
            card.classList.toggle('flipped');
            isFlipped = !isFlipped;
        }

        function updateNavigationButtons() {
            const prevBtn = document.querySelector('.prev-btn');
            const nextBtn = document.querySelector('.next-btn');
            
            // Ïù¥Ï†Ñ Î≤ÑÌäºÏùÄ currentIndexÍ∞Ä 0Î≥¥Îã§ ÌÅ¨Î©¥ ÌëúÏãú
            if (prevBtn) {
                prevBtn.classList.toggle('hidden', currentIndex <= 0);
            }
            
            // Îã§Ïùå Î≤ÑÌäºÏùÄ currentIndexÍ∞Ä ÎßàÏßÄÎßâ Ïù∏Îç±Ïä§Î≥¥Îã§ ÏûëÏúºÎ©¥ ÌëúÏãú
            if (nextBtn) {
                nextBtn.classList.toggle('hidden', currentIndex >= totalCards - 1);
            }
        }

        async function navigate(direction) {
            clearTimers();
            const newIndex = direction === 'next' ? currentIndex + 1 : currentIndex - 1;
            
            if (newIndex >= 0 && newIndex < totalCards) {
                // Ïπ¥ÎìúÎ•º ÏïûÎ©¥ÏúºÎ°ú Î¶¨ÏÖã
                if (isFlipped) {
                    flipCard();
                }
                
                // ÌòÑÏû¨ Ïù∏Îç±Ïä§ ÏóÖÎç∞Ïù¥Ìä∏
                currentIndex = newIndex;
                
                // Ïπ¥Îìú ÎÇ¥Ïö© ÏóÖÎç∞Ïù¥Ìä∏
                updateCardContent(currentIndex);
                
                // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                updateNavigationButtons();
                
                // ÌÉÄÏù¥Î®∏ Îã§Ïãú ÏãúÏûë
                startTimers();
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Ï¥àÍ∏∞Ìôî
        window.onload = function() {
            updateNavigationButtons();
            startTimers();
        };
    </script>
</body>
</html> 